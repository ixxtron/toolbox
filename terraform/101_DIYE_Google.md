# Build Infrastructure in GPC

With Terraform installed, you can dive right in and start creating some infrastructure.

### Configuration
The set of files used to describe infrastructure in Terraform is simply known as a Terraform configuration. We're going to write our first configuration now to launch a single VM instance.

The format of the configuration files is documented here. We recommend using JSON for creating configuration files.

Create a configuration an instance.tf file with your favourite editor like vim, nano etc.:

> nano instance.tf

Add the following content in file, Make sure to replace <PROJECT_ID> with the Google Cloud project ID:
```
resource "google_compute_instance" "default" {
  project      = "<PROJECT_ID>"
  name         = "terraform"
  machine_type = "n1-standard-1"
  zone         = "us-central1-a"

  boot_disk {
    initialize_params {
      image = "debian-cloud/debian-9"
    }
  }

  network_interface {
    network = "default"
    access_config {
    }
  }
}
```

This is a complete configuration that Terraform is ready to apply. The general structure should be intuitive and straightforward.

The "resource" block in the instance.tf file defines a resource that exists within the infrastructure. A resource might be a physical component such as an VM instance.

The resource block has two strings before opening the block: the resource type and the resource name. For this lab the resource type is google_compute_instance and the name is terraform. The prefix of the type maps to the provider: google_compute_instance automatically tells Terraform that it is managed by the Google provider.

Within the resource block itself is the configuration needed for the resource.

Verify your new file has been added and that there are no other *.tf files in your directory, since Terraform loads all of them:

`ls`

### Initialization
The first command to run for a new configuration -- or after checking out an existing configuration from version control -- is terraform init. This will initialize various local settings and data that will be used by subsequent commands.

Terraform uses a plugin-based architecture to support the numerous infrastructure and service providers available. Each "Provider" is its own encapsulated binary distributed separately from Terraform itself. The terraform init command will automatically download and install any Provider binary for the providers to use within the configuration, which in this case is just the Google provider.

`terraform init`

The Google provider plugin is downloaded and installed in a subdirectory of the current working directory, along with various other bookkeeping files. You will see an "Initializing provider plugins" message. Terraform knows that you're running from a Google project and is getting Google resources.

The output specifies which version of the plugin is being installed, and suggests specifying this version in future configuration files to ensure that terraform init will install a compatible version.

The `terraform plan` command is used to create an execution plan. Terraform performs a refresh, unless explicitly disabled, and then determines what actions are necessary to achieve the desired state specified in the configuration files.

`terraform plan`

This command is a convenient way to check whether the execution plan for a set of changes matches your expectations without making any changes to real resources or to the state. For example, terraform plan might be run before committing a change to version control, to create confidence that it will behave as expected.

Note: The optional -out argument can be used to save the generated plan to a file for later execution with terraform apply.
Apply Changes
In the same directory as the instance.tf file you created, run terraform apply.

`terraform apply`

This 8BAGcQptix4GVZGtF1UCJxH7rjKvaLjx5y5lgXBCwSk=output shows the Execution Plan, which describes the actions Terraform will take in order to change real infrastructure to match the configuration. The output format is similar to the diff format generated by tools like Git.

There is a + next to google_compute_instance.terraform, which means that Terraform will create this resource. Beneath that you'll see the attributes that will be set. When the value displayed is <computed>, it means that the value won't be known until the resource is created.

---

---
# HTTPS Content-Based Load Balancer with Terraform

### For complete documentation and graphics see: [ixtron docs] (https://app.gitbook.com/@ixxtron/s/xdocs/~/drafts/-MIuzuD6Ibvmtx2mb_SU/https-content-based-load-balancer-with-terraform)


## Overview
Overview
This lab creates an HTTPS load balancer to forward traffic to a custom URL map. The URL map sends traffic to the region closest to you with static assets being served from a Cloud Storage bucket. The TLS key and certificate is generated by Terraform using the TLS provider.

## Clone the sample repository
In Cloud Shell, clone the terraform-google-lb-http repository:

`git clone https://github.com/GoogleCloudPlatform/terraform-google-lb-http.git`

Navigate to the `multi-backend-multi-mig-bucket-https-lb` directory:

`cd ~/terraform-google-lb-http/examples/multi-backend-multi-mig-bucket-https-lb
Run Terraform`

## Initialize a working directory
The terraform init command is used to initialize a working directory containing Terraform configuration files. This command performs several different initialization steps to prepare a working directory for use. This command is always safe to run multiple times, to bring the working directory up to date with changes in the configuration.

Run the command:

`terraform init`

...
Terraform has been successfully initialized!
Create an execution plan
The terraform plan command is used to create an execution plan. Terraform performs a refresh, unless explicitly disabled, and then determines what actions are necessary to achieve the desired state specified in the configuration files. This command is a convenient way to check whether the execution plan for a set of changes matches your expectations without making any changes to real resources or the state. For example, terraform plan might be run before committing a change to version control, to create confidence that it will behave as expected.

Run the command. Make sure to update <PROJECT_ID> with your Qwiklabs provided project ID:

terraform plan -out=tfplan -var 'project=<PROJECT_ID>'
Example Output (do not copy):

...
Plan: 42 to add, 0 to change, 0 to destroy.
The optional -out argument can be used to save the generated plan to a file for later execution with terraform apply.

List out current directory content. You will see the saved Terraform plan (tfplan):

`ls`
Run the following:

terraform apply tfplan
